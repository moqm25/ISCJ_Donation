<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>ISCJ Fundraiser Thermometer (Light Mode)</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<style>
			:root {
				--bg: #f8fbff;
				--panel: #ffffff;
				--glass: rgba(0, 0, 0, 0.04);
				--text: #1a2230;
				--muted: #5b6b82;
				--accent: #2a80c5;
				--ring: rgba(42, 128, 197, 0.25);
				--goal: 200000;
				--thermo-w: 160px;
				--thermo-h: 720px;
				--bulb: 180px;
				--radius: 28px;
				--shadow: 0 10px 40px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.4);
			}

			/* ========== GENERAL ========== */
			* {
				box-sizing: border-box;
			}
			html,
			body {
				margin: 0;
				height: 100%;
				font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
				color: var(--text);
				background: linear-gradient(180deg, #fdfdfd, #edf2f7 80%);
			}
			.wrap {
				min-height: 100%;
				display: grid;
				grid-template-columns: 1fr auto 1fr;
				align-items: center;
				gap: clamp(24px, 3vw, 48px);
				padding: clamp(16px, 3vw, 32px);
			}
			.left,
			.right {
				display: grid;
				gap: 16px;
				align-content: center;
			}
			.panel {
				background: var(--panel);
				border: 1px solid rgba(0, 0, 0, 0.05);
				box-shadow: var(--shadow);
				border-radius: 20px;
				padding: clamp(18px, 2vw, 28px);
			}

			/* ========== KPIs ========== */
			.kpis {
				display: grid;
				gap: 16px;
			}
			.kpi {
				background: var(--glass);
				border: 1px solid rgba(0, 0, 0, 0.05);
				border-radius: 16px;
				padding: 14px 16px;
				display: grid;
				gap: 8px;
			}
			.kpi .label {
				color: var(--muted);
				font-weight: 600;
				letter-spacing: 0.02em;
				text-transform: uppercase;
				font-size: 12px;
			}
			.kpi .value {
				font-weight: 800;
				font-size: clamp(28px, 4vw, 44px);
				line-height: 1.1;
			}
			.kpi .note {
				color: var(--muted);
				font-size: 13px;
			}

			/* ========== HEADERS ========== */
			.heading {
				font-size: clamp(28px, 4vw, 52px);
				font-weight: 900;
				margin-bottom: 10px;
			}
			.sub {
				color: var(--muted);
				font-size: clamp(14px, 1.8vw, 18px);
				margin-bottom: 8px;
			}

			/* ========== THERMOMETER ========== */
			.thermo-wrap {
				position: relative;
				width: max(var(--thermo-w), 26vw);
				height: max(var(--thermo-h), 55vh);
				display: grid;
				place-items: end center;
				margin: 0 auto;
				perspective: 900px;
			}
			.stem {
				position: relative;
				width: calc(var(--thermo-w) * 0.36);
				height: calc(var(--thermo-h) - var(--bulb) * 0.58);
				background: linear-gradient(180deg, #f3f6fa, #dbe3ee);
				border-radius: var(--radius);
				border: 2px solid rgba(0, 0, 0, 0.1);
				box-shadow: var(--shadow);
				overflow: hidden;
			}
			.stem::after {
				content: "";
				position: absolute;
				inset: 0;
				background: linear-gradient(90deg, rgba(255, 255, 255, 0.5), transparent 40%, transparent 60%, rgba(255, 255, 255, 0.3));
				pointer-events: none;
			}
			.fill {
				position: absolute;
				bottom: 0;
				left: 0;
				width: 100%;
				height: 0%;
				background: linear-gradient(180deg, #ff5252, #c62828);
				transition: height 1.2s cubic-bezier(0.2, 0.8, 0.2, 1), background 600ms linear;
			}
			.tick {
				position: absolute;
				left: 8px;
				width: calc(100% - 16px);
				border-top: 2px dashed rgba(0, 0, 0, 0.1);
				pointer-events: none;
			}
			.tick-label {
				position: absolute;
				right: calc(100% + 10px);
				transform: translateY(50%);
				font-size: 12px;
				color: var(--muted);
				white-space: nowrap;
			}
			.bulb {
				position: absolute;
				bottom: 0;
				width: var(--bulb);
				height: var(--bulb);
				border-radius: 50%;
				background: radial-gradient(circle at 40% 35%, rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.3) 38%),
					linear-gradient(180deg, #f3f6fa, #dbe3ee);
				border: 2px solid rgba(0, 0, 0, 0.1);
				box-shadow: var(--shadow);
				display: grid;
				place-items: center;
			}
			.bulb-fill {
				width: calc(var(--bulb) * 0.66);
				height: calc(var(--bulb) * 0.66);
				border-radius: 50%;
				background: radial-gradient(circle at 40% 35%, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.05) 50%), #ff5252;
				box-shadow: inset 0 0 18px rgba(0, 0, 0, 0.3);
				transition: background 600ms linear;
			}

			/* ========== STATS / BUTTONS ========== */
			.statbar {
				display: grid;
				grid-template-columns: 1fr 1fr 1fr;
				gap: 10px;
				margin-top: 12px;
			}
			.pill {
				background: var(--glass);
				border: 1px solid rgba(0, 0, 0, 0.05);
				border-radius: 999px;
				padding: 10px 14px;
				display: grid;
				gap: 4px;
				justify-items: center;
			}
			.pill b {
				font-size: clamp(16px, 2.6vw, 22px);
			}
			.pill span {
				color: var(--muted);
				font-size: 12px;
			}

			.cta {
				margin-top: 8px;
				display: flex;
				gap: 8px;
				justify-content: center;
				flex-wrap: wrap;
			}
			.btn {
				background: linear-gradient(180deg, #2a80c5, #1e68aa);
				border: none;
				color: #fff;
				padding: 10px 16px;
				border-radius: 12px;
				font-weight: 700;
				letter-spacing: 0.2px;
				text-decoration: none;
				box-shadow: 0 10px 25px rgba(42, 128, 197, 0.35);
			}
			.btn:active {
				transform: translateY(1px);
			}

			@media (max-width: 1100px) {
				.wrap {
					grid-template-columns: 1fr;
				}
				.left,
				.right {
					order: 2;
				}
				.thermo-wrap {
					order: 1;
				}
				:root {
					--thermo-w: 130px;
					--bulb: 150px;
				}
			}
		</style>
	</head>

	<body>
		<!-- identical HTML structure as before -->
		<div class="wrap">
			<div class="left">
				<div class="panel">
					<h1 class="heading">ISCJ Fundraiser Progress</h1>
					<div class="sub">Every gift moves the needle â€” thank you for your generosity!</div>
					<div class="kpis">
						<div class="kpi">
							<div class="label">Raised</div>
							<div class="value" id="raised">$0</div>
							<div class="note">Auto-updates from submissions</div>
						</div>
						<div class="kpi">
							<div class="label">Goal</div>
							<div class="value" id="goal">$200,000</div>
							<div class="note">We've got this ðŸ’ª</div>
						</div>
						<div class="kpi">
							<div class="label">Remaining</div>
							<div class="value" id="remaining">$200,000</div>
							<div class="note">Until we hit the goal</div>
						</div>
					</div>
					<div class="statbar">
						<div class="pill"><b id="pct">0%</b><span>to goal</span></div>
						<div class="pill"><b id="last">â€”</b><span>last updated</span></div>
						<div class="pill"><b id="next">10s</b><span>auto-refresh</span></div>
					</div>
					<div class="cta">
						<a class="btn" href="#" onclick="toggleFullscreen();return false;">Fullscreen</a>
						<a class="btn" href="#" onclick="forceRefresh();return false;">Refresh now</a>
					</div>
				</div>
			</div>

			<div class="thermo-wrap">
				<div class="stem" id="stem">
					<div class="fill" id="fill"></div>
					<div class="tick" style="bottom: 0%"></div>
					<div class="tick-label" style="bottom: 0%">0%</div>
					<div class="tick" style="bottom: 25%"></div>
					<div class="tick-label" style="bottom: 25%">25%</div>
					<div class="tick" style="bottom: 50%"></div>
					<div class="tick-label" style="bottom: 50%">50%</div>
					<div class="tick" style="bottom: 75%"></div>
					<div class="tick-label" style="bottom: 75%">75%</div>
					<div class="tick" style="bottom: 100%"></div>
					<div class="tick-label" style="bottom: 100%">100%</div>
				</div>
				<div class="bulb"><div class="bulb-fill" id="bulb"></div></div>
				<canvas id="confetti" style="position: fixed; inset: 0; pointer-events: none; z-index: 9999"></canvas>
			</div>

			<div class="right">
				<div class="panel">
					<div class="kpi">
						<div style="display: flex; justify-content: center; align-items: center; margin: 10px 0">
							<img
								src="./pic.jpg"
								alt="Community"
								style="max-width: 100%; border-radius: 12px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1)" />
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- JS: identical to your working version -->
		<script>
			const GOAL = 200000;
			const REFRESH_MS = 10000;
			const SHEET_URL =
				"https://docs.google.com/spreadsheets/d/1nBz3ZcfR9EeA2oRAd-hz7wFHPumSGXY4FvcXHXB0Upo/export?format=csv&gid=535518416&range=A1";

			let lastTotal = 0,
				confettiFired = false;
			const $ = (s) => document.querySelector(s);
			const fmtUSD = (n) => n.toLocaleString(undefined, { style: "currency", currency: "USD", maximumFractionDigits: 0 });
			const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
			function progressColor(p) {
				const hue = 0 + 120 * p,
					sat = 90,
					light = clamp(45 + 5 * p, 45, 55);
				return `hsl(${hue},${sat}%,${light}%)`;
			}
			function setFill(p) {
				const color = progressColor(p);
				$("#fill").style.height = (p * 100).toFixed(2) + "%";
				$("#fill").style.background = `linear-gradient(180deg,${color},${color})`;
				$("#bulb").style.background = `radial-gradient(circle at 40% 35%,rgba(255,255,255,.25),rgba(255,255,255,.05) 50%),${color}`;
			}
			function setNumbers(t) {
				const p = clamp(t / GOAL, 0, 1);
				$("#raised").textContent = fmtUSD(t);
				$("#goal").textContent = fmtUSD(GOAL);
				$("#remaining").textContent = fmtUSD(Math.max(0, GOAL - t));
				$("#pct").textContent = Math.round(p * 100) + "%";
				setFill(p);
			}
			function ts() {
				return new Date().toLocaleTimeString([], { hour: "numeric", minute: "2-digit" });
			}
			function toggleFullscreen() {
				const el = document.documentElement;
				if (!document.fullscreenElement) el.requestFullscreen?.();
				else document.exitFullscreen?.();
			}
			function forceRefresh() {
				loadTotal(true);
			}
			const confettiCanvas = $("#confetti"),
				ctx = confettiCanvas.getContext("2d");
			let confettiPieces = [];
			function resizeCanvas() {
				confettiCanvas.width = innerWidth;
				confettiCanvas.height = innerHeight;
			}
			addEventListener("resize", resizeCanvas);
			resizeCanvas();
			function launchConfetti(d = 5e3) {
				if (confettiFired) return;
				confettiFired = true;
				const colors = ["#ffd166", "#ef476f", "#06d6a0", "#118ab2", "#073b4c"];
				const count = Math.min(240, Math.floor(innerWidth / 7));
				confettiPieces = Array.from({ length: count }, () => ({
					x: Math.random() * innerWidth,
					y: -20,
					w: 6 + Math.random() * 6,
					h: 10 + Math.random() * 10,
					speed: 2 + Math.random() * 3,
					tilt: Math.random() * 10,
					tiltSpeed: Math.random() * 0.06 + 0.03,
					color: colors[(Math.random() * colors.length) | 0],
					rotation: Math.random() * Math.PI,
				}));
				const start = performance.now();
				(function frame(now) {
					ctx.clearRect(0, 0, innerWidth, innerHeight);
					confettiPieces.forEach((p) => {
						p.y += p.speed;
						p.tilt += p.tiltSpeed;
						p.x += Math.sin(p.tilt) * 1.5;
						p.rotation += 0.03;
						ctx.save();
						ctx.translate(p.x, p.y);
						ctx.rotate(p.rotation);
						ctx.fillStyle = p.color;
						ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
						ctx.restore();
					});
					confettiPieces = confettiPieces.filter((p) => p.y < innerHeight + 40);
					if (now - start < d || confettiPieces.length) requestAnimationFrame(frame);
					else setTimeout(() => (confettiFired = false), 2e3);
				})(start);
			}
			async function fetchCSVNumber(url) {
				const res = await fetch(url + (url.includes("?") ? "&" : "?") + "cacheBust=" + Date.now(), { cache: "no-store" });
				const txt = await res.text();
				const cleaned = txt.replace(/[^\d.]/g, "").trim();
				const num = parseFloat(cleaned);
				if (Number.isNaN(num)) throw new Error("Invalid number " + txt);
				return Math.floor(num);
			}
			let countdownTimer = null;
			function startCountdown() {
				clearInterval(countdownTimer);
				let left = REFRESH_MS / 1000;
				$("#next").textContent = left + "s";
				countdownTimer = setInterval(() => {
					left = Math.max(0, left - 1);
					$("#next").textContent = left + "s";
				}, 1e3);
			}
			async function loadTotal(i = false) {
				try {
					const t = await fetchCSVNumber(SHEET_URL);
					console.log("Fetched total:", t, "at", new Date().toLocaleTimeString());
					setNumbers(t);
					$("#last").textContent = ts();
					if (t >= GOAL && lastTotal < GOAL) launchConfetti();
					lastTotal = t;
				} catch (e) {
					console.error(e);
				} finally {
					if (!i) startCountdown();
				}
			}
			(function init() {
				setNumbers(0);
				$("#goal").textContent = fmtUSD(GOAL);
				$("#last").textContent = "â€”";
				loadTotal(true);
				setInterval(loadTotal, REFRESH_MS);
				window.toggleFullscreen = toggleFullscreen;
				window.forceRefresh = forceRefresh;
			})();
		</script>
	</body>
</html>
